<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å—Ç–∏—Ö–æ–≤ - –ê–ª–≥–æ—Ä–∏—Ç–º –ë–ª—ç–∫–∞—É—Ç</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .input-section {
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        textarea, input[type="number"] {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        textarea:focus, input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
            white-space: pre-wrap;
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-start {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
        }

        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-start:active {
            transform: translateY(0);
        }

        .btn-reset {
            background: #f0f0f0;
            color: #333;
            flex: 1;
        }

        .btn-reset:hover {
            background: #e0e0e0;
        }

        .btn-reset:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .error-message {
            color: #d32f2f;
            font-size: 13px;
            margin-top: 5px;
        }

        .stages-section {
            display: none;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f0f0f0;
        }

        .stages-section.active {
            display: block;
        }

        .stages-label {
            color: #333;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 15px;
            display: block;
        }

        .stages-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        .btn-stage {
            padding: 10px 20px;
            background: #f0f0f0;
            color: #333;
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-stage:hover {
            background: #e0e0e0;
        }

        .btn-stage.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .text-display {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            line-height: 1.8;
            font-size: 16px;
            color: #333;
            word-wrap: break-word;
            white-space: pre-wrap;
            min-height: 150px;
            font-family: 'Georgia', serif;
        }

        .hidden-word {
            color: #667eea;
            font-weight: 600;
            letter-spacing: 0;
            cursor: help;
            position: relative;
            border-bottom: 1px dotted #667eea;
            display: inline-block;
        }

        .hidden-word:hover {
            background-color: rgba(102, 126, 234, 0.1);
            border-radius: 3px;
        }

        /* –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ç—É–ª—Ç–∏–ø */
        .hidden-word::before {
            content: attr(data-word);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: normal;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 1000;
        }

        /* –°—Ç—Ä–µ–ª–∫–∞ —Ç—É–ª—Ç–∏–ø–∞ */
        .hidden-word::after {
            content: '';
            position: absolute;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #333;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 1000;
        }

        .hidden-word:hover::before,
        .hidden-word:hover::after {
            opacity: 1;
        }

        .info-text {
            color: #666;
            font-size: 13px;
            margin-top: 15px;
            text-align: center;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 22px;
            }

            .button-group {
                flex-direction: column;
            }

            .stages-buttons {
                justify-content: center;
            }

            .hidden-word::before {
                font-size: 12px;
                padding: 4px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìñ –ó–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å—Ç–∏—Ö–æ–≤</h1>
        <p class="subtitle">–ê–ª–≥–æ—Ä–∏—Ç–º –ë–ª—ç–∫–∞—É—Ç - –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —Å–ª–æ–≤</p>

        <div class="input-section">
            <div class="input-group">
                <label for="poem">–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏—è:</label>
                <textarea id="poem" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏—è –∑–¥–µ—Å—å...">–£ –ª—É–∫–æ–º–æ—Ä—å—è –¥—É–± –∑–µ–ª—ë–Ω—ã–π;
–ó–ª–∞—Ç–∞—è —Ü–µ–ø—å –Ω–∞ –¥—É–±–µ —Ç–æ–º:
–ò –¥–Ω—ë–º –∏ –Ω–æ—á—å—é –∫–æ—Ç —É—á—ë–Ω—ã–π
–í—Å—ë —Ö–æ–¥–∏—Ç –ø–æ —Ü–µ–ø–∏ –∫—Ä—É–≥–æ–º;
–ò–¥—ë—Ç –Ω–∞–ø—Ä–∞–≤–æ ‚Äî –ø–µ—Å–Ω—å –∑–∞–≤–æ–¥–∏—Ç,
–ù–∞–ª–µ–≤–æ ‚Äî —Å–∫–∞–∑–∫—É –≥–æ–≤–æ—Ä–∏—Ç.
–¢–∞–º —á—É–¥–µ—Å–∞: —Ç–∞–º –ª–µ—à–∏–π –±—Ä–æ–¥–∏—Ç,
–†—É—Å–∞–ª–∫–∞ –Ω–∞ –≤–µ—Ç–≤—è—Ö —Å–∏–¥–∏—Ç;
–¢–∞–º –Ω–∞ –Ω–µ–≤–µ–¥–æ–º—ã—Ö –¥–æ—Ä–æ–∂–∫–∞—Ö
–°–ª–µ–¥—ã –Ω–µ–≤–∏–¥–∞–Ω–Ω—ã—Ö –∑–≤–µ—Ä–µ–π;
–ò–∑–±—É—à–∫–∞ —Ç–∞–º –Ω–∞ –∫—É—Ä—å–∏—Ö –Ω–æ–∂–∫–∞—Ö
–°—Ç–æ–∏—Ç –±–µ–∑ –æ–∫–æ–Ω, –±–µ–∑ –¥–≤–µ—Ä–µ–π;</textarea>
                <span class="error-message" id="poemError"></span>
            </div>

            <div class="input-group">
                <label for="stages">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ç–∞–ø–æ–≤ –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:</label>
                <input type="number" id="stages" min="2" max="10" value="5" placeholder="–û—Ç 2 –¥–æ 10">
                <span class="error-message" id="stagesError"></span>
            </div>

            <div class="button-group">
                <button class="btn-start" onclick="startExercise()">–ù–∞—á–∞—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
                <button class="btn-reset" id="resetBtn" onclick="resetExercise()" disabled>–°–±—Ä–æ—Å</button>
            </div>
        </div>

        <div class="stages-section" id="stagesSection">
            <span class="stages-label">–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–ø:</span>
            <div class="stages-buttons" id="stagesButtons"></div>
            <div class="text-display" id="textDisplay"></div>
            <p class="info-text" id="infoText"></p>
        </div>
    </div>

    <script>
        let stagesData = [];
        let currentStage = 0;

        function startExercise() {
            const poemText = document.getElementById('poem').value;
            const stagesCount = parseInt(document.getElementById('stages').value);

            console.log('–¢–µ–∫—Å—Ç:', poemText);
            console.log('–≠—Ç–∞–ø—ã:', stagesCount);

            // –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫
            document.getElementById('poemError').textContent = '';
            document.getElementById('stagesError').textContent = '';

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            let hasError = false;
            if (!poemText.trim()) {
                document.getElementById('poemError').textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏—è';
                hasError = true;
            }
            if (!stagesCount || stagesCount < 2 || stagesCount > 10) {
                document.getElementById('stagesError').textContent = '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ç–∞–ø–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 2 –¥–æ 10';
                hasError = true;
            }

            if (hasError) return;

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —ç—Ç–∞–ø—ã, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–µ–∫—Å—Ç–∞
            if (!generateStages(poemText, stagesCount)) {
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —ç—Ç–∞–ø–æ–≤
            document.getElementById('stagesSection').classList.add('active');
            document.getElementById('resetBtn').disabled = false;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —ç—Ç–∞–ø
            showStage(0);
        }

        function generateStages(text, stagesCount) {
            // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç—Ä–æ–∫–∏, —Å–æ—Ö—Ä–∞–Ω—è—è –ø–µ—Ä–µ–Ω–æ—Å—ã
            const lines = text.split('\n');

            console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫:', lines.length);

            // –ò–∑–≤–ª–µ–∫–∞–µ–º –≤—Å–µ —Å–ª–æ–≤–∞ (–±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã, –≤–∫–ª—é—á–∞—è –∫–∏—Ä–∏–ª–ª–∏—Ü—É)
            const allWords = [];
            lines.forEach((line, lineIndex) => {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –≥–∏–±–∫–æ–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ª—é–±—ã—Ö –±—É–∫–≤
                const parts = line.match(/[–∞-—è–ê-–Ø—ë–Åa-zA-Z0-9]+/g) || [];
                console.log(`–°—Ç—Ä–æ–∫–∞ ${lineIndex}:`, parts);
                parts.forEach(word => {
                    allWords.push(word);
                });
            });

            console.log('–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ —Å–ª–æ–≤:', allWords.length);
            console.log('–°–ª–æ–≤–∞:', allWords);

            if (allWords.length === 0) {
                document.getElementById('poemError').textContent = '–¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–ª–æ–≤–æ';
                return false;
            }

            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Å–ª–æ–≤–∞ –ø–æ –¥–ª–∏–Ω–µ
            const wordsByLength = {};
            allWords.forEach(word => {
                const length = word.length;
                if (!wordsByLength[length]) {
                    wordsByLength[length] = [];
                }
                wordsByLength[length].push(word);
            });

            // –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–ª–∏–Ω—ã –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Ö
            const lengths = Object.keys(wordsByLength)
                .map(Number)
                .sort((a, b) => a - b);

            console.log('–î–ª–∏–Ω—ã —Å–ª–æ–≤:', lengths);

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Ä–æ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
            const thresholds = [];
            const minLength = lengths[0];
            const maxLength = lengths[lengths.length - 1];

            for (let i = 0; i < stagesCount; i++) {
                const threshold = minLength + (maxLength - minLength) * (i / (stagesCount - 1));
                thresholds.push(threshold);
            }

            console.log('–ü–æ—Ä–æ–≥–∏:', thresholds);

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞, —Å–æ—Ö—Ä–∞–Ω—è—è –ø–µ—Ä–µ–Ω–æ—Å—ã –∏ –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è
            stagesData = [];
            for (let i = 0; i < stagesCount; i++) {
                const processedLines = lines.map(line => {
                    // –ó–∞–º–µ–Ω—è–µ–º —Å–ª–æ–≤–∞, —Å–æ—Ö—Ä–∞–Ω—è—è –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É
                    return line.replace(/[–∞-—è–ê-–Ø—ë–Åa-zA-Z0-9]+/g, (word) => {
                        const wordLength = word.length;
                        // –°–∫—Ä—ã–≤–∞–µ–º —Å–ª–æ–≤–æ, –µ—Å–ª–∏ –µ–≥–æ –¥–ª–∏–Ω–∞ <= –ø–æ—Ä–æ–≥–æ–≤–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é —Ç–µ–∫—É—â–µ–≥–æ —ç—Ç–∞–ø–∞
                        if (wordLength <= thresholds[i]) {
                            return `<span class="hidden-word" data-word="${word}">` + '‚Ä¢'.repeat(wordLength) + '</span>';
                        }
                        return word;
                    });
                }).join('\n');

                stagesData.push(processedLines);
            }

            return true;
        }

        function showStage(stageIndex) {
            currentStage = stageIndex;

            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            const buttons = document.querySelectorAll('.btn-stage');
            buttons.forEach((btn, index) => {
                btn.classList.toggle('active', index === stageIndex);
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç —ç—Ç–∞–ø–∞
            document.getElementById('textDisplay').innerHTML = stagesData[stageIndex];

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            const totalStages = stagesData.length;
            document.getElementById('infoText').textContent = 
                `–≠—Ç–∞–ø ${stageIndex + 1} –∏–∑ ${totalStages}`;

            // –°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫–∏ —ç—Ç–∞–ø–æ–≤
            const stagesButtonsContainer = document.getElementById('stagesButtons');
            if (stagesButtonsContainer.children.length === 0) {
                for (let i = 0; i < totalStages; i++) {
                    const button = document.createElement('button');
                    button.className = 'btn-stage';
                    button.textContent = `–≠—Ç–∞–ø ${i + 1}`;
                    button.onclick = () => showStage(i);
                    if (i === stageIndex) button.classList.add('active');
                    stagesButtonsContainer.appendChild(button);
                }
            }
        }

        function resetExercise() {
            document.getElementById('poem').value = `–£ –ª—É–∫–æ–º–æ—Ä—å—è –¥—É–± –∑–µ–ª—ë–Ω—ã–π;
–ó–ª–∞—Ç–∞—è —Ü–µ–ø—å –Ω–∞ –¥—É–±–µ —Ç–æ–º:
–ò –¥–Ω—ë–º –∏ –Ω–æ—á—å—é –∫–æ—Ç —É—á—ë–Ω—ã–π
–í—Å—ë —Ö–æ–¥–∏—Ç –ø–æ —Ü–µ–ø–∏ –∫—Ä—É–≥–æ–º;
–ò–¥—ë—Ç –Ω–∞–ø—Ä–∞–≤–æ ‚Äî –ø–µ—Å–Ω—å –∑–∞–≤–æ–¥–∏—Ç,
–ù–∞–ª–µ–≤–æ ‚Äî —Å–∫–∞–∑–∫—É –≥–æ–≤–æ—Ä–∏—Ç.
–¢–∞–º —á—É–¥–µ—Å–∞: —Ç–∞–º –ª–µ—à–∏–π –±—Ä–æ–¥–∏—Ç,
–†—É—Å–∞–ª–∫–∞ –Ω–∞ –≤–µ—Ç–≤—è—Ö —Å–∏–¥–∏—Ç;
–¢–∞–º –Ω–∞ –Ω–µ–≤–µ–¥–æ–º—ã—Ö –¥–æ—Ä–æ–∂–∫–∞—Ö
–°–ª–µ–¥—ã –Ω–µ–≤–∏–¥–∞–Ω–Ω—ã—Ö –∑–≤–µ—Ä–µ–π;
–ò–∑–±—É—à–∫–∞ —Ç–∞–º –Ω–∞ –∫—É—Ä—å–∏—Ö –Ω–æ–∂–∫–∞—Ö
–°—Ç–æ–∏—Ç –±–µ–∑ –æ–∫–æ–Ω, –±–µ–∑ –¥–≤–µ—Ä–µ–π;`;
            document.getElementById('stages').value = '5';
            document.getElementById('stagesSection').classList.remove('active');
            document.getElementById('resetBtn').disabled = true;
            document.getElementById('textDisplay').innerHTML = '';
            document.getElementById('poemError').textContent = '';
            document.getElementById('stagesError').textContent = '';
            document.getElementById('stagesButtons').innerHTML = '';
            stagesData = [];
        }

        // –ü–æ–∑–≤–æ–ª—è–µ–º –∑–∞–ø—É—Å–∫–∞—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –ø–æ Enter
        document.getElementById('stages').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') startExercise();
        });
    </script>
</body>
</html>
